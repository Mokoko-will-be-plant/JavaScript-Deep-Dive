# 실행 컨텍스트

## 실행컨텍스트란?

: 소스코드를 실행하는데 필요한 환경을 제공하고 코드의 실행 결과를 실제로 관리하는 영역이다.
식별자와 스코프는 실행 컨텍스트의 렉시컬환경으로 관리하고 코드실행 순서는 실행컨텍스트 스택으로 관리한다.

<br/>

### 소스코드의 타입

- 전역 코드: 전역에 존재하는 소스 코드(전역에 정의된 함수, 클래스 등 내부 코드는 제외)
- 함수 코드: 함수 내부에 존재하는 코드(중첩 함수, 클래스 등의 내부 함수는 제외)
- eval 코드: 빌트인 전역 함수인 eval 함수에 인수로 전달되어 실행되는 코드
- 모듈 코드: 모듈 내부에 존재하는 코드(모듈 내부의 함수, 클래스 등의 내부코드는 제외)

위 4가지 타입의 소스코드는 실행 컨텍스트를 생성한다

<br/>

## 소스코드의 평가와 실행

- 소스코드 평가

1. 실행컨텍스트 생성
2. 변수, 함수 선언문만 먼저 실행, 생성된 함수 식별자 키로 실행 컨텍스트 스코프에 등록

- 소스코드 실행:

1. 소스코드를 순차적으로 실행
2. 소스코드에 필요한 정보를 스코프에서 검색하여 취득
3. 변수 값의 변경 등 소스코드의 실행결과를 다시 컨텍스트 스코프에 등록

<br/>

## 실행 컨텍스트 스택

: 코드의 실행 순서를 관리한다.
소스코드가 평가되면 실행 컨텍스트가 생성되고 실행 컨텍스트 스택의 최상위에 쌓인다.
실행 컨텍스트 스택의 최상위에 존재하는 실행 컨텍스트는 언제나 현재 실행중인 코드의 실행 컨텍스트다.

<br/>

## 렉시컬 환경

: 렉시컬 환경은 식별자와 식별자에 바인딩된 값, 그리고 상위 스코프에 대한 참조를 기록하는 자료구조 실행 컨텍스트를 구성하는 컴포넌트다. 렉시컬환경은 스코프와 식별자를 관리한다.

- 렉시컬환경의 구성

1. 환경레코드
2. 외부 렉시컬 환경에 대한 참조

<br/>

## 실행 컨텍스트의 생성과 식별자 검색 과정

```
var x = 1;
const y = 2;

function foo(a) {
    var x = 3;
    const y  = 4;

    function bar(b) {
        const z = 5;
        console.log(a + b + x + y + z);
    }
    bar(10);
}

foo(20); // 42
```

1. 전역 객체 생성
2. 전역 코드 평가
   2-1. 전역 실행 컨텍스트 생성
   2-2. 전역 렉시컬 환경 생성
   2-2-1. 전역 환경 레코드 생성
   2-2-1-1. 객체 환경 레코드 생성
   2-2-2-2. 선언적 환경 레코드 생성
   2-2-2. this 바인딩
   2-3. 외부 렉시컬 환경에 대한 참조 결정

<내부 함수 foo>

1. 함수 실행 컨텍스트 생성
2. 함수 렉시컬 환경 생성
   2-1. 함수 환경 레코드 생성
   2-2. this 바인딩
   2-3. 외부 렉시컬 환경에 대한 참조 결정
