브라우저의 렌더링 과정


파싱 - 텍스트 문서의 문자열을 토큰으로 분해하고 토큰의 문법적 의미와 구조를 반영하여 트리구조인 파스 트리를 생성하는 과정.

렌더링 - html, css , js로 작성된 문서를 파싱하여 브라우저에 시각적으로 출력하는것.

## 브라우저의 렌더링 과정

렌더링 리소스들은 모두 서버에 존재해 서버에다 요청하고 응답받은 리소스를 파싱해서 렌더링함.


1. Html, css, js, 이미지, 폰트파일등 렌더링 리소스를 요청하고 서버로부터 응답받음
2. 렌더링 엔진이 서버에서 응답반은 html, css를 파싱해서 dom과 cssom을 생성하고 렌더트리를 생성한다.
3. 자바스크립트 엔진은 서버로부터 응답된 js를 파싱해 ast를 생성하고 바이트코드로 변환하여 실행. 이때 js는 dom api로 dom과 cssom을 변경할 수 있다. 이 때 변경된 내용은 다시 렌더트리에 결함된다.
4. 렌더 트리를 기반으로 html요소의 레이아웃을 계산하고 화면에 페인팅한다.


브라우저 주소창에 url 입력 -> url호스트명으로 dns를 통해 ip 주소 변환 -> 해당 ip 주소 서버에 요청 전송


### HTTP 1.1/ 2.0

HTTP/1.1 - 커넥션당 하나의 요청과 응답만 처리 => 리소스의 개수에 비례해 응답시간이 증가함
HTTP/2.0 - 다중 요청/응답 가능 => 1.1에 비해 페이지 로드 속도가 50%정도 빠름


### HTML파싱과 DOM 생성

서버에서 응답한 html문서는 문자열로 이루어진 순수 텍스트.
이 텍스트를 렌더링 엔진이 파싱해서 브라우저가 이해할 수 있는 자료구조인 dom을 생성

### css 파싱과 cssom 생성

렌더링엔진이 dom을 생성하다가 css를 로드하는 link나 style태그를 만나면 dom 생성을 일시중단한다.

cssom은 css의 상속을 반영하여 생성된다. 

### 렌더 트리 생성

렌더링 엔진이 파싱을 통해 생성한 dom과 cssom은 렌더트리로 결합된다.

렌더 트리 - 브라우저 화면에 렌더링 되는 노드만으로 구성된 렌더링을 위한 트리구조의 자료구조. 
렌더트리는 각 요소의 레이아웃을 계산하는데 사용되며 화면에 픽셀을 렌더링하는 페인팅 처리에 입력된다.

브라우저의 렌더링 과정은 js에 의한 노드 추가, 삭제 등의 과정으로 인해 위의 과정이 반복해서 실행될 수 있다. 

### 자바스크립트의 파싱과 실행

자바스크립트 엔진이 처리함.
자바스크립트 코드를 파싱해 cpu가 이해할 수 있는 저수준 언어로 변환하고 실행한다.

자바스크립트 엔진은 js를 해석하여 ast를 생성한다. 이를 기반으로 인터프리터가 실행할 수 있는 바이트 코드를 생성하여 실행한다.

토크나이징 : js 소스코드를 코드의 최소 단위인 토큰으로 분해하는것
Ast : 토큰에 문법적 의미와 구조를 반영한 트리형의 자료구조
ast(추상적 구문 트리)를 사용하면 타입스크립트, 바벨, 프리티어 같은 트랜스파일러를 구현할 수도 있다. 

### 리플로우와 리페인트

* 리플로우 - 레이아웃 계산 재실행, 노드 추가/삭제, 요소 크기/위치 변경 등 레이아웃에 영향을 주는 변경 발생시 실행
* 리페인트 - 재결합된 렌드트리를 기반으로 다시 페인트하는것


렌더링엔진과 자바스크립트 엔진은 직렬적으로 파싱을 수행

브라우저는 동기적으로 html, css, js를 파싱하고 실행한다.

script 태그의 위치에 따라 html 파싱이블로킹되어 dom 생성이 지연될 수 있기 때문에 script태그의 위치는 중요하다.
dom의 생성이 일시 중단되어 dom이생성되기 전에 dom이나 ssom을 변경하는 api를 사용할 경우 문제가 발생할 수 잇다.

이 문제를 피하기 위해 body 가장아래에 자바스크립트 태그를 위치한다.

=> 자바스크립트가 실행될떄는 이미 렌덜이 엔진이 html요소를 파싱해서 dom을 생성한 이후기떄문에 에러가 발생안함.
또한 js 실행이전에 dom 생성이 완료되어 페이지 로딩시간이 단축된다.

### Async/defer 어트리뷰트

js파싱으로 인한 dom생성 블록킹을 해결하위해 추가된 어트리뷰트

Src 어트리뷰트를 통해 외부 자바스크립트 파일을 로드할 때 사용.
html파싱과 외부 자바스크립트 파일의 로드가 비동기로 동시에 진행됨. 

Async - js의 파싱과 실행은 js파일의 로드가 완료된 직후 html파싱을 중단하고 진행

Defer - js의 파싱과 실행은 html파싱이 완료된 직후(dom 생성이 완료된 직후)진행됨. 
Dom 생성 완료 이후에 실행되어야 할 js에 사용.
